<!DOCTYPE html>
<html>

<head>
    <title>Music Latex Annotation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <style>
        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        .key {
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            text-align: center;
            cursor: pointer;
        }

        .output-container {
            margin-top: 20px;
            font-size: 16px;
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 100px;
            /* Adjust as needed */
            width: 80%;
            /* Adjust as needed */
            overflow-y: auto;
        }

        textarea {
            margin-top: 20px;
            width: 80%;
            /* Adjust as needed */
            height: 100px;
            /* Adjust as needed */
        }

        .active {
            background-color: lightblue;
        }
    </style>
</head>

<body>
    <h1>Music Latex Annotation</h1>
    <textarea id="textInput"></textarea>
    <div class="keyboard"></div>
    <div class="output-container" id="output"></div>
    <script>
        const keyboard = document.querySelector('.keyboard');
        const outputElement = document.querySelector('#output');
        const textInput = document.querySelector('#textInput');
        let latexOutput = '';

        const keys = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', 'Subscript', 'SuperScript', 'Single Underline', 'Double Underline', 't', 'y', 'u', 'i', 'o', 'p', 'S', 'R1', 'R2', 'G1', 'G2', 'M1', 'M2', 'P', 'D1', 'D2', ',', '.', ';', '-', '=', 'dha2', 'm', ',', '.', '/', ' ', '(', ')'];

        keys.forEach(key => {
            const keyElement = document.createElement('div');
            keyElement.classList.add('key');
            keyElement.textContent = key;
            keyElement.addEventListener('click', () => {
                const cursorPosition = textInput.selectionStart; // Get cursor position
                const textBeforeCursor = textInput.value.substring(0, cursorPosition);
                const textAfterCursor = textInput.value.substring(cursorPosition);

                if (key === 'Single Underline') {
                    textInput.value = textBeforeCursor + '\\overline{}' + textAfterCursor; // Add \overline{} template
                    latexOutput = textBeforeCursor + '\\overline{}' + textAfterCursor;
                    renderLatexOutput();
                    textInput.selectionStart = cursorPosition + 10; // Move cursor position
                    textInput.selectionEnd = cursorPosition + 10;
                } else if (key === 'Double Underline') {
                    textInput.value = textBeforeCursor + '\\overline{\\overline{}}' + textAfterCursor; // Add \overline{\overline{}} template
                    latexOutput = textBeforeCursor + '\\overline{\\overline{}}' + textAfterCursor;
                    renderLatexOutput();
                    textInput.selectionStart = cursorPosition + 20; // Move cursor position
                    textInput.selectionEnd = cursorPosition + 20;
                } else if (key === 'Subscript') {
                    textInput.value = textBeforeCursor + '_{}' + textAfterCursor; // Modified: Use _{} template for subscript
                    latexOutput = textBeforeCursor + '_{}' + textAfterCursor;
                    renderLatexOutput();
                    textInput.selectionStart = cursorPosition + 2; // Modified: Move cursor position
                    textInput.selectionEnd = cursorPosition + 2;
                } else if (key === 'SuperScript') {
                    textInput.value = textBeforeCursor + '^{}' + textAfterCursor; // Modified: Use ^{} template for superscript
                    latexOutput = textBeforeCursor + '^{}' + textAfterCursor;
                    renderLatexOutput();
                    textInput.selectionStart = cursorPosition + 2; // Modified: Move cursor position
                    textInput.selectionEnd = cursorPosition + 2;
                } else if (key === ' ') {
                    textInput.value = textBeforeCursor + ' ' + textAfterCursor; // Add space
                    latexOutput = textBeforeCursor + ' ' + textAfterCursor;
                    renderLatexOutput();
                    textInput.selectionStart = cursorPosition + 1; // Move cursor position
                    textInput.selectionEnd = cursorPosition + 1;
                } else {
                    textInput.value = textBeforeCursor + key + textAfterCursor; // Append key to text input
                    latexOutput = textBeforeCursor + key + textAfterCursor;
                    textInput.selectionStart = cursorPosition + key.length; // Move cursor position
                    textInput.selectionEnd = cursorPosition + key.length;
                    renderLatexOutput();
                }
            });
            keyboard.appendChild(keyElement);
        });

        function renderLatexOutput() {
            outputElement.innerHTML = '$$' + latexOutput + '$$';
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, outputElement]);
        }

        // Update latexOutput when user edits the text input
        textInput.addEventListener('input', () => {
            latexOutput = textInput.value;
            renderLatexOutput();
        });
    </script>
</body>

</html>
